server {
    client_max_body_size 16M;
    listen $PORT;
    root /etc/nginx/html;

    if ($http_x_forwarded_proto = "http") {
	    return 301 https://$server_name$request_uri;
    }

    location /internal/ {
        root /static;
    }

    location /soknadsosialhjelp/ {
        return 301 https://digisos.labs.nais.io/sosialhjelp/soknad/mock-login;
    }
    location /sosialhjelp/soknad {
        return 302 https://digisos.labs.nais.io/sosialhjelp/soknad/;
    }
    location /sosialhjelp/innsyn {
        return 302 https://digisos.labs.nais.io/sosialhjelp/innsyn/;
    }

    # BEGIN Søknad master branch

    location /sosialhjelp/soknad/ {
        proxy_set_header Host sosialhjelp-soknad.labs.nais.io;
        proxy_pass https://sosialhjelp-soknad.labs.nais.io/sosialhjelp/soknad/;
        proxy_ssl_server_name on;
    }

    location /sosialhjelp/soknad-api/ {
        proxy_set_header Host sosialhjelp-soknad-api.labs.nais.io;
        proxy_pass https://sosialhjelp-soknad-api.labs.nais.io/sosialhjelp/soknad-api/;
        proxy_ssl_server_name on;
    }

    location /sosialhjelp/login-api/soknad-api/ {
        proxy_set_header Host sosialhjelp-soknad-api.labs.nais.io;
        proxy_pass https://sosialhjelp-soknad-api.labs.nais.io/sosialhjelp/soknad-api/;
        proxy_ssl_server_name on;
    }
    # END Søknad master branch

    # BEGIN Innsyn master branch
    location /sosialhjelp/innsyn/ {
        proxy_set_header Host sosialhjelp-innsyn.labs.nais.io;
        proxy_pass https://sosialhjelp-innsyn.labs.nais.io/sosialhjelp/innsyn/;
        proxy_ssl_server_name on;
    }

    location /sosialhjelp/login-api/innsyn-api/ {
        proxy_set_header Host sosialhjelp-innsyn-api.labs.nais.io;
        proxy_pass https://sosialhjelp-innsyn-api.labs.nais.io/sosialhjelp/innsyn-api/;
        proxy_ssl_server_name on;
    }

    location /sosialhjelp/innsyn-api/ {
        proxy_set_header Host sosialhjelp-innsyn-api.labs.nais.io;
        proxy_pass https://sosialhjelp-innsyn-api.labs.nais.io/sosialhjelp/innsyn-api/;
        proxy_ssl_server_name on;
    }
    # END Innsyn master branch

    # BEGIN Søknad feature branch
    location ~* ^/(?<app>[^/]+)/sosialhjelp/soknad(?<context>-api)?/(?<path>.*)$ {
        resolver 8.8.8.8;
        proxy_set_header Host $app$context.herokuapp.com;
        proxy_pass https://$app$context.herokuapp.com/sosialhjelp/soknad$context/$path?$args;
        proxy_ssl_server_name on;
    }

    location ~* ^/(?<app>[^/]+)/sosialhjelp/login-api/soknad-api/(?<path>.*)$ {
        resolver 8.8.8.8;
        proxy_set_header Host $app-api.herokuapp.com;
        proxy_pass https://$app-api.herokuapp.com/sosialhjelp/soknad-api/$path?$args;
        proxy_ssl_server_name on;
    }
    # END Søknad feature branch

    # BEGIN Innsyn feature branch
    location ~* ^/(?<app>[^/]+)/sosialhjelp/innsyn/(?<path>.*)$ {
        resolver 8.8.8.8;
        proxy_set_header Host $app.herokuapp.com;
        proxy_pass https://$app.herokuapp.com/sosialhjelp/innsyn/$path?$args;
        proxy_ssl_server_name on;
    }

    location ~* ^/(?<app>[^/]+)/sosialhjelp/login-api/innsyn-api/(?<path>.*)$ {
        resolver 8.8.8.8;
        proxy_set_header Host $app-api.herokuapp.com;
        proxy_pass https://$app-api.herokuapp.com/sosialhjelp/innsyn-api/$path?$args;
        proxy_ssl_server_name on;
    }
    # END Innsyn feature branch

    location /sosialhjelp/fagsystem-mock/ {
        proxy_set_header Host sosialhjelp-fagsystem-mock.labs.nais.io;
        proxy_pass https://sosialhjelp-fagsystem-mock.labs.nais.io/sosialhjelp/fagsystem-mock/;
        proxy_ssl_server_name on;
    }
    location /sosialhjelp/fagsystem-mock {
        proxy_set_header Host sosialhjelp-fagsystem-mock.labs.nais.io;
        proxy_pass https://sosialhjelp-fagsystem-mock.labs.nais.io/sosialhjelp/fagsystem-mock/;
        proxy_ssl_server_name on;
    }

    location /sosialhjelp/ {
        proxy_set_header Host sosialhjelp-veiviser.labs.nais.io;
        proxy_pass https://sosialhjelp-veiviser.labs.nais.io/sosialhjelp/;
        proxy_ssl_server_name on;
    }
    location /sosialhjelp {
        proxy_set_header Host sosialhjelp-veiviser.labs.nais.io;
        proxy_pass https://sosialhjelp-veiviser.labs.nais.io/sosialhjelp/;
        proxy_ssl_server_name on;
    }
}
